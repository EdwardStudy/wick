#!/usr/bin/env bash

wickExplorer OS wick-base os

case "$OS" in
    redhat|centos)
        wickInfo "Adding EPEL repository"
        ;;

    *)
        wickInfo "EPEL repository not needed for this OS: $OS"
        exit
esac

INSTALLED=$(rpm -qa | grep ^epel-release- || true)

if [[ ! -z "$INSTALLED" ]]; then
    wickInfo "EPEL package already installed: $INSTALLED"
    exit
fi

PACKAGE=$(rpm -q --whatprovides /etc/redhat-release)

wickTempDir TEMP

(
    cd "$TEMP"

    case "$PACKAGE" in
        *.el5.*)
            wickGetUrl "http://dl.fedoraproject.org/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm" epel.rpm
            ;;

        *.el6.*)
            wickGetUrl "http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm" epel.rpm
            ;;

        *.el7.*)
            wickGetUrl "http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm" epel.rpm
            ;;
    esac

    if [[ -f epel.rpm ]]; then
        rpm -Uvh epel.rpm
    fi
)
