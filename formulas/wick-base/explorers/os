#!/usr/bin/env bash

is-really-centos() {
    rpm -q centos-release > /dev/null 2>&1
}

detect-real-redhat() {
    if is-really-centos; then
        echo "centos"
    else
        echo "redhat"
    fi
}

if wickCommandExists lsb_release; then
    DISTRIBUTOR=$(lsb-release -s -i 2>&1)
    wickDebug "Distributor: $DISTRIBUTOR"

    case "$DISTRIBUTOR" in
        RedHatEnterprise*)
            detect-real-redhat
            exit
            ;;

        Ubuntu)
            echo "ubuntu"
            exit
            ;;
    esac
fi

wickDebug "MACHTYPE=$MACHTYPE"

if [[ "$MACHTYPE" == *"-redhat-"* ]]; then
    detect-real-redhat
    exit
fi

if [[ "$MACHTYPE" == *"-apple-"* ]]; then
    echo "osx"
    exit
fi

if wickCommandExists uname; then
    UNAME_V=$(uname -v 2>&1)
    wickDebug "UNAME_V=$UNAME_V"

    if [[ "$UNAME_V" == *"Ubuntu"* ]]; then
        echo "ubuntu"
        exit
    fi
fi

wickError "Unable to detect OS"
echo "UNKNOWN"
exit 1
