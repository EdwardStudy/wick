#!/usr/bin/env bash

# Starting in deepest parent, write lib/* with a header
show-all-lib-functions() {
    local FILE

    if [[ -d "$1/parent" ]]; then
        show-all-lib-functions "$1/parent"
    fi

    if [[ -d "$1/lib" ]]; then
        for FILE in "$1/lib/"*; do
            if wickIsValidScript "$FILE"; then
                echo "# $FILE"
                cat "$FILE"
                echo ""
            fi
        done
    fi
}

(
    echo "#!/usr/bin/env bash"
    echo "#"
    echo "# This file was created by the wick-infect formula"
    echo ""
    echo '[ ! -z "$BASH_VERSION" ] || return 1'
    echo '[[ "$POSIXLY_CORRECT" != "y" ]] || return 1'
    echo ""
    show-all-lib-functions .
) > "$WICK_FORMULA_DIR/files/wick-infect"

wickFormula wick-base
