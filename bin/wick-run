#!/bin/bash
#
# Executes one role

wick-on-load wick-add-command run "Execute the formulas for a given role"


# Runs a single role and passes additional arguments to the role
#
# Parameters:
#     $1: Role to execute
#     $2-*: Arguments to pass to the role's script.
# Returns true on success.
wick-run() {
    local FORMULA I LOCATION ROLE

    if [[ -z "$1" ]]; then
        echo "You must specify a role to execute." >&2

        return 1
    fi

    wick-load-role "$@"

    if [[ ${#WICK_FORMULA_COMMANDS[@]} -eq 0 ]]; then
        echo "No formulas listed or no run scripts found for the formulas."

        # This is not an error with Wick.
        return 0
    fi

    I=0

    while [[ $I -lt ${#WICK_FORMULA_LIST[@]} ]]; do
        echo "Order of formulas to execute [$I]: ${WICK_FORMULA_LIST[$I]}"
        I=$(($I + 1))
    done

    for FORMULA in "${WICK_FORMULA_COMMANDS[@]}"; do
        # CAREFUL - keep the formula quoted here.
        wick-run-formula "$FORMULA"
    done

    echo "Done."
}
