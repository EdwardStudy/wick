#!/bin/bash

wick-get-url() {
    local DEST PROGRESS TIMEOUT URL

    wick-get-option PROGRESS progress "$@"
    wick-get-option TIMEOUT timeout "$@"
    wick-get-argument URL 0 "$@"
    wick-get-argument DEST 1 "$@"
    wick-debug "wick-get-url url: $URL"
    wick-debug "wick-get-url dest: $DEST"

    if wick-command-exists curl; then
        wick-get-url-curl || return 1
        return 0
    fi

    if wick-command-exists wget; then
        wick-get-url-wget || return 1
        return 0
    fi

    wick-error "Unable to download url - no suitable programs found"
    return 1
}

wick-get-url-curl() {
    local ARGS

    ARGS=(curl -L -f)
    [[ -z "$PROGRESS" ]] && ARGS[${#ARGS[@]}]="-s"
    [[ ! -z "$TIMEOUT" ]] && {
        ARGS[${#ARGS[@]}]="-m"
        ARGS[${#ARGS[@]}]=$TIMEOUT
    }
    [[ ! -z "$DEST" ]] && {
        ARGS[${#ARGS[@]}]="-o"
        ARGS[${#ARGS[@]}]=$DEST
    }
    ARGS[${#ARGS[@]}]=$URL
    wick-debug "wick-get-url: ${ARGS[@]}"
    "${ARGS[@]}"
}

wick-get-url-wget() {
    local ARGS

    ARGS=(wget)
    [[ -z "$PROGRESS" ]] && ARGS[${#ARGS[@]}]="--quiet"
    [[ ! -z "$TIMEOUT" ]] && {
        ARGS[${#ARGS[@]}]="--timeout"
        ARGS[${#ARGS[@]}]=$TIMEOUT
    }
    [[ ! -z "$DEST" ]] && {
        ARGS[${#ARGS[@]}]="-O"
        ARGS[${#ARGS[@]}]=$DEST
    }
    ARGS[${#ARGS[@]}]=$URL
    wick-debug "wick-get-url: ${ARGS[@]}"
    "${ARGS[@]}"
}
