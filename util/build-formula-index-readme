#!/usr/bin/env bash
# Builds a README.md based on the README.md from formulas.  Writes the contents
# to stdout.
#
# Examples
#
#   util/build-formula-index-readme formulas/README.md
#
# Returns nothing.

# Print the header
cat "$1" | sed '/AUTOGENERATED LIST START/,$d'

# Add the header back in and a bit of padding
echo "[//] # (AUTOGENERATED LIST START)"
echo ""

# For each formula in the same folder
for f in "${1%/*}/"*/README.md; do
    # Get the link that should be displayed
    link=${f#${1%/*}/}
    # Get the heading from the README
    # Link to the README.md file
    # Get the first description line
    echo "* [$(head -n 1 "$f")](${link}) - $(sed '1,3d;5,$d' "$f")"
done

# Add the footer marker and padding
echo ""
echo "[//] # (AUTOGENERATED LIST END)"

# Print the footer
cat "$1" | sed '1,/AUTOGENERATED LIST END/d'
