#!/usr/bin/env bash

output=$1
readme=$2
shift 2
contents=$(cat "$readme" | sed '/ # .AUTOGENERATED CONTENT START/,$d')
while [[ ${contents: -1} == '\n' ]]; do
    contents=${contents:0:-1}
done
contents+=$'\n'
contents+=$'\n'
contents+=$'\n'
contents+=$'[//] # ; (AUTOGENERATED CONTENT START)\n'
contents+=$'\n'
contents+=$'\n'
contents+=$(${0%/*}/tomdoc.sh -m "$@")

if [[ "$output" == "-" ]] || [[ -z "$output" ]]; then
    echo "$contents"
else
    echo "$contents" > "$output"
fi
