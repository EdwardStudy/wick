#!/usr/bin/env bash
# Builds a README.md based on other files in the same directory.  Writes the
# contents to stdout.
#
# Examples
#
#   util/build-readme bin/README.md
#
# Returns nothing.

# Get the header of the file and remove the rest
cat "$1" | sed '/AUTOGENERATED CONTENT START/,$d'

# Add the marker back in and a bit of padding
echo '[//] # (AUTOGENERATED CONTENT START)'
echo ""
echo ""

# For each file in the same folder
for f in "${1%/*}/"*; do
    # Make sre we don't process ourself nor a similarly named temp file
    if [[ $f != $1* ]]; then
        # Pass through tomdoc
        ${0%/*}/tomdoc.sh -m "$f"
    fi
done
